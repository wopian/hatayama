machine:
    node:
        version: stable

general:
    artifacts:
        - coverage/**/lcov.info

dependencies:
    cache_directories:
        - node_modules
        - app/vendor
        - app/styles/vendor
    pre:
#       - npm i
       - npm i -g gulp
    override:
#       - npm update && npm prune
        - gulp build:tidy
        - bundle install

test:
    override:
        - gulp test
        - mkdir -p $CIRCLE_TEST_REPORTS/junit/
        - ls coverage && ls coverage/**
        - ls $CIRCLE_TEST_REPORTS
        - cp coverage/**/cobertura-coverage.xml $CIRCLE_TEST_REPORTS/junit/test-results.xml
        - ls $CIRCLE_TEST_REPORTS/junit
    post:
        - bash <(curl -s https://codecov.io/bash)

deployment:
    production:
        branch: master
        heroku:
            appname: hatayama